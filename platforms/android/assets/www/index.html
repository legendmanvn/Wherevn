<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title></title>

    <link rel="manifest" href="manifest.json">

    <!-- un-comment this code to enable service worker
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(() => console.log('service worker installed'))
          .catch(err => console.log('Error', err));
      }
    </script>-->

    <link href="lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/menu.css">
    <script type="text/javascript" src="scripts/jquery-1.11.1.min.js"></script>
    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>
    <style>
            html, body, #map-canvas {
                height: 100%;
                margin: 0px;
                padding: 0px
            }
      .contextmenu{
       visibility:hidden;
        background:#ffffff;
        border:1px solid #8888FF;
        z-index: 10;
        position: relative;
        width: 200px;
      }
      .contextmenu div{
      padding-left: 5px
      }
        </style>
    <!-- your app's js -->
        <script src="js/jquery.form.js"></script> 
        <script src="js/bootstrap.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/controllers.js"></script>
    <script src="js/services.js"></script>
    <script>
          function myFunction(){

                //addMarker(myLatlng, content);
                 var lat = '<?php echo $lat; ?>';
                 var lng = '<?php echo $lng; ?>';
          //  map.setCenter(10.8230989,106.6296638);
                  map.setZoom(15);
                  var latLng = new google.maps.LatLng(parseFloat(lat),parseFloat(lng));
            map.setCenter(latLng);
            // map.setCenter(parseFloat(lat),parseFloat(lng));
      };
      var map;
          var markers = [];
      var addmarkers = [];
          function initMap2() {
            var myLatlng = new google.maps.LatLng(16.0401833,106.4823441);
            // alert(1);
            map = new google.maps.Map(document.getElementById('map-canvas'), {
                zoom: 6,
                center: myLatlng,
                mapTypeId: 'roadmap'
            });
        map.addListener('click', function() {
          var infowindow = null;
          var html = "abcd";
          infoWindow.setContent(html);
          infoWindow = new google.maps.InfoWindow;
            });
        google.maps.event.addListener(map, "rightclick",function(event){
          var toadolat = event.latLng.lat();
          var toadolng = event.latLng.lng();
          removeMarkers();
          content = '<a href="member/add/' + toadolat +'/'+toadolng +'"><input type="submit" value="Thêm thông tin địa điểm"></a>';
          addMarker(event.latLng,content);
       
        });
        function addMarker(location, content) {
          var infowindow = new google.maps.InfoWindow({
            content: content
          });
          var marker = new google.maps.Marker({
            position: location,
            map: map
          });
          infowindow.open(map, marker);
          addmarkers.push(marker);
        }

        var province = "all";
        var district = "all";
        var group1 = "all";
        var group2 = "all";
        var group3 = "all";
           initMap(province,district,group1,group2,group3);
        };
      function initMap(province,district,group1,group2,group3) {
        deleteMarkers();
        if (province == '')
        {
          province = document.getElementById('provinceSelected').value;
        } else {
          document.getElementById('provinceSelected').value = province;
        }
        if (district == '')
        {
          district = document.getElementById('districtSelected').value;
        } else {
          document.getElementById('districtSelected').value = district;
        }
        if (group1 == '')
        {
          group1 = document.getElementById('group1Selected').value;
        } else {
          document.getElementById('group1Selected').value = group1;
        }
        if (group2 == '')
        {
          group2 = document.getElementById('group2Selected').value;
        } else {
          document.getElementById('group2Selected').value = group2;
        }
        if (group3 == '')
        {
          group3 = document.getElementById('group3Selected').value;
        } else {
          document.getElementById('group3Selected').value = group3;
        }
        var url = 'http://locationviewer.wherevn.com/initmap/getlocation';
        var data2 = {province: province,district: district,grouplevel1:group1,grouplevel2:group2,grouplevel3:group3};
        // alert(3);
            $.ajax({ 
                type: "POST",
                url: url, 
                data: data2,
                cache:false,
                timeout: 5000,
                success: 
                    function(data){
                      console.log(data);
                      // alert(2);
                       data = JSON.parse(data);
                       $.each(data, function(key, loc) {
                var customIcons = {
                  phongkham: {
                    icon: 'http://labs.google.com/ridefinder/images/mm_20_blue.png'
                    },
                  tramyte: {
                    icon: 'http://labs.google.com/ridefinder/images/mm_20_blue.png'
                    },
                  benhvien: {
                      icon: 'http://labs.google.com/ridefinder/images/mm_20_red.png'
                    },
                  vip: {
                    icon: 'http://phongkham.wherevn.com/images/hospital-building.png'
                  }
                };
                var infoWindow = new google.maps.InfoWindow;
                var userid = loc.userid;
                var phonenumber = loc.phonenumber;
                var note = loc.note;
                var name = loc.name;
                var address = loc.address;
                var type = loc.type;
                var linkvip = ''
                if (type == 'vip') {
                  linkvip = "<br/>" + '<a target="_blank" href="http://cafe.wherevn.com/member/info/' + loc.id +'"><b>Xem chi tiết thông tin địa điểm</b></a>'
                }
                var html = 'Mã địa điểm: '+loc.id+"</br><b>" + name + "</b><br/>"+ "Điện thoại: "+ phonenumber +"<br/>Địa chỉ: "+ address + "<br/>Mô tả: " + note + linkvip;
                
                var icon = customIcons[type] || {};
                         var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(loc.lat, loc.lng),
                            map: map,
                  icon: icon.icon
                        });
                markers.push(marker);
                bindInfoWindow(marker, map, infoWindow, html);
              });
                    }
            });
            // alert(4)
      }
      function removeMarkers(){
        for(i=0; i< addmarkers.length; i++){
          addmarkers[i].setMap(null);
        }
      }
      function bindInfoWindow(marker, map, infoWindow, html) {
        google.maps.event.addListener(marker, 'click', function() {
          var zoomLevel = map.getZoom();
          document.getElementById('abc').value = zoomLevel;
          map.setZoom(zoomLevel);
          infoWindow.setContent(html);
          infoWindow.setOptions({maxWidth:250});
          infoWindow.open(map, marker);
        });
      };
          function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
              markers[i].setMap(map);
            }
        }
          function clearMarkers() {
            setMapOnAll(null);
          }
          function showMarkers() {
            setMapOnAll(map);
          }
          function deleteMarkers() {
            clearMarkers();
            markers = [];
          }
        function about(){
        content = '<b>Giới thiệu Công ty</b><br/>Công ty TNHH Giải pháp số iSolution là đơn vị chuyên cung cấp giải pháp ứng dụng công nghệ thông tin cho doanh nghiệp trong hoạt động quản lý, sản xuất - kinh doanh.<br/>Tên đầy đủ: <b>Công ty TNHH Giải pháp số iSolution</b><br/>Tên viết tắt: <b>Công ty GPS iSolution</b><br/>Mã số thuế: 0313390291<br/>Địa chỉ: 146A Liêu Bình Hương, Củ Chi, Hồ Chí Minh<br/>Điện thoại: 01.23.24.25.247<br/><b>Lý do ra đời</b><br/>Hình thức kinh doanh online đã không còn xa lạ với đa số người tiêu dùng tại nhiều thành phố trong cả nước; các doanh nghiệp với nhiều quy mô và ngành nghề khác nhau đều, đã và đang tiến hành “online hóa” hoạt động kinh doanh của mình. Các loại sản phẩm được kinh doanh online hiện nay khá đa dạng, từ đồ gia dụng, thiết bị cơ khí, thiết bị y tế, thiết bị điện và điện tử… đến các mặt hàng nhu yếu phẩm, thời trang, trang sức, mỹ phẩm, sách, đồ lưu niệm, văn phòng phẩm…, đa đạng về nguồn gốc và cả chất lượng. Chỉ với vài cú click chuột trên máy tính có kết nối Internet hoặc vài thao tác đơn giản trên chiếc smartphone, người tiêu dùng có thể tìm và mua được những món hàng yêu thích với mức giá hợp lý mà không tốn nhiều thời gian và công sức. Với nhà phân phối, người tiêu dùng cũng có thể lựa chọn những đơn vị có dịch vụ và sản phẩm tốt nhất, tránh hiện tượng “độc quyền” trên thị trường. Kinh doanh online đã trở thành một lĩnh vực đầy sức hút, đem lại lợi ích cho cả người kinh doanh lẫn những khách hàng cần mua sắm nhưng lại quá bận rộn để có thể đi shopping thường xuyên. Trên lý thuyết, kinh doanh online cũng không bị giới hạn trong bất kỳ phạm vi địa lý nào bởi Internet là không biên giới. Tuy nhiên, nếu nhìn vào thực tế hiện nay, có thể thấy rõ rằng thị trường đầy hứa hẹn này thật ra chỉ phổ biến ở các thành phố, thị xã lớn, những nơi có nền kinh tế, dịch vụ và công nghệ tương đối phát triển. Ngược lại, mua sắm online vẫn còn rất xa lạ với đa số người tiêu dùng ở các vùng nông thôn, các vùng còn kém phát triển, trong khi đây lại là những nơi khan hiếm hàng hóa, điều kiện đi lại mua sắm khó khăn. Trừ một vài thương hiệu lớn (kèm theo đó là mức giá cao) thì các doanh nghiệp vừa và nhỏ, các cửa hàng và cá nhân đều chưa tạo được uy tín cao trên thị trường kinh doanh online; khách hàng thường là người quen biết hoặc qua giới thiệu thì mới dám giao dịch. Ngoài ra, việc mua sắm online cũng còn nhiều điều vướng mắc. Chính những điều đáng lẽ trở thành ích lợi cũng có thể cản trở người tiêu dùng như nguồn hàng hóa quá nhiều và đa dạng. Phải là người từng băn khoăn chọn mua sản phẩm online mới hiểu hết những khó khăn của khách hàng: nguồn hàng hóa quá đa dạng, nhiều xuất xứ khác nhau, món hàng nào cũng đi kèm những lời quảng cáo hấp dẫn rất khó chọn lựa; không đảm bảo được nguồn gốc và chất lượng hàng hóa khi mua; các dịch vụ bảo hành, chăm sóc khách hàng còn chưa rõ ràng; quy trình đặt mua và chuyển phát hàng hóa ở nhiều trang web còn nhiêu khê, phức tạp… và nhất là tâm lý “chưa mua bao giờ” nên e dè, ngần ngại. Một vấn đề nữa là với tốc độ phát triển công nghệ nhanh chóng, có nhiều sản phẩm, đồ gia dụng mới ra đời mỗi ngày nhưng lại không được số đông khách hàng biết đến, dù họ chính là những người có nhu cầu sử dụng.<br/><b>Mục tiêu phát triển</b><br/>Chính từ những yêu cầu đó, Công ty TNHH Giải pháp số iSolution ra đời. Là đơn vị cung cấp giải pháp kinh doanh online chuyên nghiệp, iSolution hoạt động với mục tiêu thúc đẩy phát triển thị trường kinh doanh online, giúp giới thiệu sản phẩm đến nhiều lượt người tiêu dùng, khắc phục những trở ngại và phát huy tối đa những thế mạnh của hình thức kinh doanh online. Đúng như tên gọi, Giải pháp số iSolution là cầu nối mang sản phẩm đến người tiêu dùng, giúp mọi người ứng dụng và phục vụ cuộc sống cũng như nhu cầu giải trí, giúp cuộc sống không chỉ dễ dàng mà còn thoải mái hơn.';
        var infowindow = new google.maps.InfoWindow({
          content: content
        });
        var marker = new google.maps.Marker({
          position: new google.maps.LatLng(10.971560, 106.506737),
          map: map
        });
        map.setZoom(18);
        map.setCenter(marker.getPosition());
        infowindow.open(map, marker);
      };
      </script>
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOsEQMLECadC73KgVuvRr9J8yK1hwL6tE&language=vi&callback=initMap2">
    </script>
  </head>
  <body class="platform-android platform-cordova platform-webview">
  <div id="map-canvas"></div>
    <div id="wrapper">
      <header id="header">
        <div class="inner">
          <nav>
            <ul>
              <li><a href="#menu">Menu</a></li>
            </ul>
          </nav>

        </div>
      </header>
      <nav id="menu">
        <h2>Menu</h2>
        <ul>
          <li>
            <input type="hidden" id="abc" value="">
            <input type="hidden" id="provinceSelected" value="all">
            <select name="province" onchange="initMap(this.value,'','','','')">
              <option value="all" selected>Click để lọc theo tỉnh</option>
              <option value="hanoi">Hà Nội</option>
              <option value="hochiminh">Hồ Chí Minh</option>
              <option value="danang">Đà Nẵng</option>
              <option value="haiphong">Hải Phòng</option>
              <option value="cantho">Cần Thơ</option>
            </select>
          </li>
          <li>
            <input type="hidden" id="districtSelected" value="all">
            <select name="district" onchange="initMap('',this.value,'','','')">
              <option value="all" selected>Click để lọc theo quận/huyện</option>
              <option value="quan1">Quận 1</option>
              <option value="quan2">Quận 2</option>
              <option value="quan3">Quận 3</option>
              <option value="tanbinh">Quận Tân Bình</option>
            </select>
          </li>
          <li>  
            <input type="hidden" id="group1Selected" value="all">
            <select name="group1" onchange="initMap('','',this.value,'','')">
              <option value="all" selected>Click để lọc theo lĩnh vực</option>
              <option value="anuong">Ăn uống</option>
              <option value="vieclam">Việc làm</option>
              <option value="dichvu">Dịch vụ</option>
            </select>
          </li>
          <li>  
            <input type="hidden" id="group2Selected" value="all">
            <select name="group2" onchange="initMap('','','',this.value,'')">
              <option value="all" selected>Click để lọc theo ngành nghề</option>
              <option value="a">a</option>
              <option value="b">b</option>
              <option value="c">c</option>
            </select>
          </li>
          <li>  
            <input type="hidden" id="group3Selected" value="all">
            <select name="group3" onchange="initMap('','','','',this.value)">
              <option value="all" selected>Click để lọc theo nhu cầu</option>
              <option value="cung">Cung</option>
              <option value="cau">Cầu</option>
            </select>
          </li>
          <li>
            <select name="group3" onchange="about()">
              <option value="all" selected>Nhà tài trợ</option>
              <option value="cung">Công ty GPS iSoution</option>
            </select>
          </li>
        </ul>
      </nav>
    </div>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/popup.js"></script>
  </body>
</html>
